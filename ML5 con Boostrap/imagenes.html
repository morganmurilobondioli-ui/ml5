<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detecci칩n de im치genes con ML5 + Bootstrap</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- p5 y ml5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.0/p5.min.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
  </head>

  <body class="bg-light">
    <div class="container text-center mt-5">
      <h2 class="mb-4">Clasificador de im치genes con ML5</h2>

      <!-- Contenedor del canvas -->
      <div id="canvas-container" class="d-flex justify-content-center mb-4"></div>

      <!-- Tarjeta de resultados -->
      <div class="card mx-auto shadow-sm border-0 col-md-6">
        <div class="card-body">
          <h5 class="card-title">Resultados</h5>
          <div id="results-container" class="text-start"></div>
        </div>
      </div>
    </div>

    <script>
      let classifier;
      let img;

      function preload() {
        classifier = ml5.imageClassifier("MobileNet");
        img = loadImage("images/image-6.jpg"); 
      }

      function setup() {
        const canvas = createCanvas(400, 400);
        canvas.parent("canvas-container");
        image(img, 0, 0, width, height);
        classifier.classify(img, gotResult);
      }

      function gotResult(results) {
        console.log(results);

        const container = document.getElementById("results-container");
        container.innerHTML = ""; // limpiar contenido anterior

        

        // Mostrar las 3 primeras predicciones
        results.slice(0, 3).forEach((res, i) => {
          const porcentaje = (res.confidence * 100).toFixed(2);

          // Crea elementos de Bootstrap din치micamente
          const label = document.createElement("p");
          label.classList.add("fw-semibold", "mb-1", "mt-3");
          label.innerText = `${i + 1}. ${res.label} (${porcentaje}%)`;

          const progressDiv = document.createElement("div");
          progressDiv.classList.add("progress", "mb-2");

          const progressBar = document.createElement("div");
          progressBar.classList.add(
            "progress-bar",
            "progress-bar-striped",
            "progress-bar-animated",
            "bg-success"
          );
          progressBar.style.width = `${porcentaje}%`;
          progressBar.setAttribute("aria-valuenow", porcentaje);
          progressBar.setAttribute("aria-valuemin", "0");
          progressBar.setAttribute("aria-valuemax", "100");

          // Ensamblar todo
          progressDiv.appendChild(progressBar);
          container.appendChild(label);
          container.appendChild(progressDiv);
        });
      }
    </script>
  </body>
</html>